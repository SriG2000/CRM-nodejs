<div class="campaign-page">
  <div class="page-header">
    <div class="header-content">
      <div class="header-info">
        <div class="breadcrumb">
          <a href="#" (click)="goBackToJobSeekers(); $event.preventDefault()" class="breadcrumb-link">
            <svg class="breadcrumb-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
            </svg>
            Job Seekers
          </a>
          <svg class="breadcrumb-separator" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
          </svg>
          <span class="breadcrumb-current">Campaign Builder</span>
        </div>
        <h1 class="page-title">
          <svg class="title-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 4.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path>
          </svg>
          {{ title }}
        </h1>
        <p class="page-description">Create personalized drip email campaigns for your selected job seekers</p>
      </div>
      <div class="header-actions">
        <button class="btn btn-outline" type="button" (click)="openTemplateModal()">
          <svg class="btn-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
          </svg>
          View Templates
        </button>
        <button class="btn btn-primary" type="button" (click)="openCreateModal()">
          <svg class="btn-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
          </svg>
          Create Template
        </button>
      </div>
    </div>
    <div class="status-container" *ngIf="statusMessage">
      <div class="status-message" [ngClass]="{ 'status-success': statusType === 'success', 'status-error': statusType === 'error' }">
        <svg class="status-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24" *ngIf="statusType === 'success'">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
        </svg>
        <svg class="status-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24" *ngIf="statusType === 'error'">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
        </svg>
        {{ statusMessage }}
      </div>
    </div>
  </div>

  <div class="campaign-layout">
    <div class="settings-panel">
      <div class="panel-header">
        <div class="panel-title">
          <svg class="panel-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path>
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
          </svg>
          Campaign Settings
        </div>
      </div>

      <div class="form-section">
        <div class="form-group">
          <label for="campaignName" class="form-label">
            <svg class="label-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z"></path>
            </svg>
            Campaign Name
          </label>
          <input
            id="campaignName"
            name="campaignName"
            type="text"
            [(ngModel)]="campaignName"
            placeholder="e.g., Welcome Series 2024"
            class="form-input"
          />
        </div>

        <div class="form-group">
          <label for="numDrips" class="form-label">
            <svg class="label-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path>
            </svg>
            Number of Emails
          </label>
          <div class="input-group">
            <input
              id="numDrips"
              type="number"
              min="1"
              [ngModel]="numDrips"
              (ngModelChange)="handleDripCountChange($event)"
              class="form-input"
            />
            <button class="btn btn-icon-only" type="button" (click)="addDrip()" title="Add Email">
              <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
              </svg>
            </button>
          </div>
        </div>

        <div class="form-group global-settings">
          <label for="globalInterval" class="form-label">
            <svg class="label-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
            </svg>
            Default Wait Time
          </label>
          <select
            id="globalInterval"
            [(ngModel)]="globalInterval"
            class="form-select"
          >
            <option *ngFor="let interval of timeIntervals" [ngValue]="interval.value">
              {{ interval.label }}
            </option>
          </select>
          <button class="btn btn-secondary" type="button" (click)="applyGlobalInterval()">
            <svg class="btn-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
            </svg>
            Apply to All
          </button>
          <p class="help-text">Set default interval for all emails (except the first)</p>
        </div>
      </div>

      <div class="stats-section">
        <div class="stats-grid">
          <div class="stat-item">
            <div class="stat-value">{{ drips.length }}</div>
            <div class="stat-label">Total Emails</div>
          </div>
          <div class="stat-item">
            <div class="stat-value">~{{ totalDays }}</div>
            <div class="stat-label">Days Duration</div>
          </div>
          <div class="stat-item">
            <div class="stat-value">{{ configuredDrips }}/{{ drips.length }}</div>
            <div class="stat-label">Configured</div>
          </div>
        </div>
      </div>

      <div class="panel-footer">
        <button class="btn btn-success btn-large" type="button" (click)="saveCampaign()" [disabled]="isSaving">
          <svg class="btn-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24" *ngIf="!isSaving">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
          </svg>
          <svg class="btn-icon spinning" fill="none" stroke="currentColor" viewBox="0 0 24 24" *ngIf="isSaving">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
          </svg>
          {{ isSaving ? 'Saving Campaign...' : 'Save Campaign' }}
        </button>
      </div>
    </div>

    <div class="workflows-panel">
      <div class="panel-header">
        <div class="panel-title">
          <svg class="panel-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path>
          </svg>
          Email Workflows
        </div>
        <div class="workflow-count">{{ drips.length }} Email{{ drips.length !== 1 ? 's' : '' }}</div>
      </div>

      <div class="workflow-timeline">
        <div
          class="workflow-step"
          *ngFor="let drip of drips; let index = index; trackBy: trackByDripId"
        >
          <div class="step-indicator">
            <div class="step-number">{{ index + 1 }}</div>
            <div class="step-line" *ngIf="index < drips.length - 1"></div>
          </div>

          <div class="workflow-card">
            <div class="workflow-header">
              <div class="workflow-info">
                <h3 class="workflow-title">
                  Email #{{ index + 1 }}
                  <span class="workflow-badge" *ngIf="drip.template">Configured</span>
                </h3>
                <p class="workflow-subtitle" *ngIf="index === 0">
                  <svg class="inline-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                  </svg>
                  Sends immediately
                </p>
                <p class="workflow-subtitle" *ngIf="index > 0">
                  <svg class="inline-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                  </svg>
                  Waits {{ getIntervalLabel(drip.interval) }}
                </p>
              </div>
              <button 
                class="btn btn-icon-only btn-danger" 
                type="button" 
                (click)="removeDrip(drip.id)" 
                *ngIf="drips.length > 1"
                title="Remove Email"
              >
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                </svg>
              </button>
            </div>

            <div class="workflow-content">
              <div class="workflow-form-grid">
                <div class="form-group" *ngIf="index > 0">
                  <label class="form-label">
                    <svg class="label-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                    Wait Time
                  </label>
                  <select [ngModel]="drip.interval" (ngModelChange)="updateDripInterval(drip.id, $event)" class="form-select">
                    <option *ngFor="let interval of timeIntervals" [ngValue]="interval.value">
                      {{ interval.label }}
                    </option>
                  </select>
                </div>

                <div class="form-group" [ngClass]="{ 'full-width': index === 0 }">
                  <label class="form-label">
                    <svg class="label-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                    </svg>
                    Email Template
                  </label>
                  <select [ngModel]="drip.template" (ngModelChange)="updateDripTemplate(drip.id, $event)" class="form-select">
                    <option value="">Select template...</option>
                    <option *ngFor="let template of emailTemplates" [ngValue]="template.id">
                      {{ template.name }}
                    </option>
                  </select>
                </div>
              </div>

              <div class="template-preview" *ngIf="drip.template">
                <div class="preview-header">
                  <div class="preview-title">
                    <svg class="preview-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                    </svg>
                    {{ getTemplateName(drip.template) }}
                  </div>
                  <button type="button" class="btn btn-outline btn-sm" (click)="previewTemplate(drip.template)">
                    <svg class="btn-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
                    </svg>
                    Preview
                  </button>
                </div>
                <p class="preview-description">{{ getTemplateDescription(drip.template) }}</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Templates Modal -->
  <div class="modal-overlay" *ngIf="showTemplateModal" (click)="closeTemplateModal()">
    <div class="modal-container" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <div class="modal-title">
          <svg class="modal-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
          </svg>
          Email Templates
        </div>
        <button type="button" class="btn btn-icon-only btn-ghost" (click)="closeTemplateModal()" title="Close">
          <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
          </svg>
        </button>
      </div>
      <div class="modal-body">
        <div class="templates-grid">
          <div class="template-item" *ngFor="let template of emailTemplates">
            <div class="template-icon">
              <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
              </svg>
            </div>
            <div class="template-content">
              <h4 class="template-name">{{ template.name }}</h4>
              <p class="template-desc">{{ template.description }}</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Create Template Modal -->
  <div class="modal-overlay" *ngIf="showCreateModal" (click)="closeCreateModal()">
    <div class="modal-container modal-large" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <div class="modal-title">
          <svg class="modal-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
          </svg>
          Advanced Template Creator
        </div>
        <button type="button" class="btn btn-icon-only btn-ghost" (click)="closeCreateModal()" title="Close">
          <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
          </svg>
        </button>
      </div>
      <div class="modal-body">
        <div class="template-creator">
          <div class="creator-tabs">
            <button 
              class="tab-btn" 
              [class.active]="activeTab === 'basic'"
              (click)="activeTab = 'basic'">
              <svg class="tab-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
              </svg>
              Basic Info
            </button>
            <button 
              class="tab-btn" 
              [class.active]="activeTab === 'content'"
              (click)="activeTab = 'content'">
              <svg class="tab-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
              </svg>
              Content
            </button>
            <button 
              class="tab-btn" 
              [class.active]="activeTab === 'signature'"
              (click)="activeTab = 'signature'">
              <svg class="tab-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
              </svg>
              Signature
            </button>
            <button 
              class="tab-btn" 
              [class.active]="activeTab === 'preview'"
              (click)="activeTab = 'preview'">
              <svg class="tab-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
              </svg>
              Preview
            </button>
          </div>

          <div class="tab-content">
            <!-- Basic Info Tab -->
            <div class="tab-panel" *ngIf="activeTab === 'basic'">
              <div class="form-section">
                <div class="form-group">
                  <label for="templateName" class="form-label">
                    <svg class="label-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z"></path>
                    </svg>
                    Template Name
                  </label>
                  <input 
                    id="templateName" 
                    type="text" 
                    [(ngModel)]="templateForm.name" 
                    placeholder="e.g., Product Launch Email" 
                    class="form-input"
                  />
                </div>
                <div class="form-group">
                  <label for="templateDescription" class="form-label">
                    <svg class="label-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                    </svg>
                    Description
                  </label>
                  <input
                    id="templateDescription"
                    type="text"
                    [(ngModel)]="templateForm.description"
                    placeholder="Brief description of this template"
                    class="form-input"
                  />
                </div>
                <div class="form-group">
                  <label for="templateCategory" class="form-label">
                    <svg class="label-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"></path>
                    </svg>
                    Category
                  </label>
                  <select id="templateCategory" [(ngModel)]="templateForm.category" class="form-select">
                    <option value="welcome">Welcome</option>
                    <option value="follow-up">Follow-up</option>
                    <option value="promotional">Promotional</option>
                    <option value="newsletter">Newsletter</option>
                    <option value="announcement">Announcement</option>
                    <option value="reminder">Reminder</option>
                  </select>
                </div>
                <div class="form-group">
                  <label for="companyLogo" class="form-label">
                    <svg class="label-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                    </svg>
                    Company Logo
                  </label>
                  <div class="image-upload-container">
                    <input 
                      type="file" 
                      id="companyLogo" 
                      accept="image/*" 
                      (change)="onLogoUpload($event)"
                      class="file-input"
                    />
                    <label for="companyLogo" class="upload-btn">
                      <svg class="upload-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"></path>
                      </svg>
                      Upload Logo
                    </label>
                    <div class="logo-preview" *ngIf="templateForm.logoUrl">
                      <img [src]="templateForm.logoUrl" alt="Company Logo" />
                      <button type="button" class="remove-logo" (click)="removeLogo()">
                        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Content Tab -->
            <div class="tab-panel" *ngIf="activeTab === 'content'">
              <div class="content-editor">
                <div class="editor-toolbar">
                  <div class="toolbar-group">
                    <button type="button" class="toolbar-btn" (click)="formatText('bold')" title="Bold">
                      <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 4h8a4 4 0 014 4 4 4 0 01-4 4H6z"></path>
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 12h9a4 4 0 014 4 4 4 0 01-4 4H6z"></path>
                      </svg>
                    </button>
                    <button type="button" class="toolbar-btn" (click)="formatText('italic')" title="Italic">
                      <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 4h6v16h-6V4z"></path>
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 12h6"></path>
                      </svg>
                    </button>
                    <button type="button" class="toolbar-btn" (click)="formatText('underline')" title="Underline">
                      <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m0 0l-4-4m4 4l4-4"></path>
                      </svg>
                    </button>
                  </div>
                  <div class="toolbar-group">
                    <button type="button" class="toolbar-btn" (click)="insertHeading('h1')" title="Heading 1">H1</button>
                    <button type="button" class="toolbar-btn" (click)="insertHeading('h2')" title="Heading 2">H2</button>
                    <button type="button" class="toolbar-btn" (click)="insertHeading('h3')" title="Heading 3">H3</button>
                  </div>
                  <div class="toolbar-group">
                    <button type="button" class="toolbar-btn" (click)="insertLink()" title="Insert Link">
                      <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"></path>
                      </svg>
                    </button>
                    <button type="button" class="toolbar-btn" (click)="insertImage()" title="Insert Image">
                      <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                      </svg>
                    </button>
                  </div>
                  <div class="toolbar-group">
                    <button type="button" class="toolbar-btn" (click)="insertButton()" title="Insert Button">
                      <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v8m-4-4h8"></path>
                      </svg>
                    </button>
                    <button type="button" class="toolbar-btn" (click)="insertDivider()" title="Insert Divider">
                      <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 12H4"></path>
                      </svg>
                    </button>
                  </div>
                </div>
                <div 
                  class="content-editor-area"
                  contenteditable="true"
                  [innerHTML]="templateForm.content"
                  (input)="onContentChange($event)"
                  placeholder="Start writing your email content here...">
                </div>
              </div>
            </div>

            <!-- Signature Tab -->
            <div class="tab-panel" *ngIf="activeTab === 'signature'">
              <div class="signature-builder">
                <div class="signature-preview">
                  <div class="signature-header">
                    <h4>Signature Preview</h4>
                  </div>
                  <div class="signature-content" [innerHTML]="getSignaturePreview()"></div>
                </div>
                <div class="signature-form">
                  <div class="form-group">
                    <label class="form-label">
                      <svg class="label-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                      </svg>
                      Full Name
                    </label>
                    <input type="text" [(ngModel)]="templateForm.signature.name" placeholder="John Doe" class="form-input" />
                  </div>
                  <div class="form-group">
                    <label class="form-label">
                      <svg class="label-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 13.255A23.931 23.931 0 0112 15c-3.183 0-6.22-.62-9-1.745M16 6V4a2 2 0 00-2-2h-4a2 2 0 00-2-2v2m8 0H8m8 0v2a2 2 0 01-2 2H10a2 2 0 01-2-2V6m8 0H8"></path>
                      </svg>
                      Job Title
                    </label>
                    <input type="text" [(ngModel)]="templateForm.signature.title" placeholder="Senior Developer" class="form-input" />
                  </div>
                  <div class="form-group">
                    <label class="form-label">
                      <svg class="label-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"></path>
                      </svg>
                      Company
                    </label>
                    <input type="text" [(ngModel)]="templateForm.signature.company" placeholder="Your Company Inc." class="form-input" />
                  </div>
                  <div class="form-group">
                    <label class="form-label">
                      <svg class="label-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 4.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path>
                      </svg>
                      Email
                    </label>
                    <input type="email" [(ngModel)]="templateForm.signature.email" placeholder="john@company.com" class="form-input" />
                  </div>
                  <div class="form-group">
                    <label class="form-label">
                      <svg class="label-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"></path>
                      </svg>
                      Phone
                    </label>
                    <input type="tel" [(ngModel)]="templateForm.signature.phone" placeholder="+1 (555) 123-4567" class="form-input" />
                  </div>
                  <div class="form-group">
                    <label class="form-label">
                      <svg class="label-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path>
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path>
                      </svg>
                      Address
                    </label>
                    <textarea [(ngModel)]="templateForm.signature.address" placeholder="123 Main St, City, State 12345" class="form-textarea" rows="3"></textarea>
                  </div>
                  <div class="form-group">
                    <label class="form-label">
                      <svg class="label-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                      </svg>
                      Profile Photo
                    </label>
                    <div class="image-upload-container">
                      <input 
                        type="file" 
                        accept="image/*" 
                        (change)="onSignaturePhotoUpload($event)"
                        class="file-input"
                      />
                      <label class="upload-btn">
                        <svg class="upload-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"></path>
                        </svg>
                        Upload Photo
                      </label>
                      <div class="photo-preview" *ngIf="templateForm.signature.photoUrl">
                        <img [src]="templateForm.signature.photoUrl" alt="Profile Photo" />
                        <button type="button" class="remove-photo" (click)="removeSignaturePhoto()">
                          <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                          </svg>
                        </button>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Preview Tab -->
            <div class="tab-panel" *ngIf="activeTab === 'preview'">
              <div class="template-preview-container">
                <div class="preview-header">
                  <h4>Email Preview</h4>
                  <div class="preview-actions">
                    <button type="button" class="btn btn-outline btn-sm" (click)="refreshPreview()">
                      <svg class="btn-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
                      </svg>
                      Refresh
                    </button>
                  </div>
                </div>
                <div class="email-preview">
                  <div class="email-container">
                    <div class="email-header" *ngIf="templateForm.logoUrl">
                      <img [src]="templateForm.logoUrl" alt="Company Logo" class="company-logo" />
                    </div>
                    <div class="email-content" [innerHTML]="getFullTemplatePreview()"></div>
                    <div class="email-signature" [innerHTML]="getSignaturePreview()"></div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-outline" (click)="closeCreateModal()">Cancel</button>
        <button type="button" class="btn btn-primary" (click)="createTemplate()">
          <svg class="btn-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
          </svg>
          Create Template
        </button>
      </div>
    </div>
  </div>

  <!-- Preview Modal -->
  <div class="modal-overlay" *ngIf="selectedTemplatePreview as templateId" (click)="closePreview()">
    <div class="modal-container modal-large" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <div class="modal-title">
          <svg class="modal-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
          </svg>
          {{ getTemplateName(templateId) }}
        </div>
        <button type="button" class="btn btn-icon-only btn-ghost" (click)="closePreview()" title="Close">
          <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
          </svg>
        </button>
      </div>
      <div class="modal-body">
        <div class="preview-section">
          <div class="preview-header-info">
            <h4 class="preview-subtitle">{{ getTemplateDescription(templateId) }}</h4>
          </div>
          <div class="preview-content">
            <div class="preview-text">
              {{ getTemplateContent(templateId) || 'Template content preview not available.' }}
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
